<html layout:decorate="~{layout}">
<div layout:fragment="content">
    <div style="width:30%; font-size:15pt; margin:0 auto;">
        <h3 class="border-bottom pb-2">비밀번호 찾기</h3>
        <div class="alert alert-danger" role="alert">
            사용자 정보를 입력해주세요.
        </div>
        <form th:action="@{/user/check}" method="post">
            <div class="mb-3">
                <label for="username" class="form-label">아이디</label>
                <input type="text" name="username" class="form-control" id="usernameInput">
            </div>
            <div class="mb-3">
                <label for="email" class="form-label">이메일</label>
                <input type="email" name="email" class="form-control" id="emailInput">
            </div>
            <div class="d-flex justify-content-end">
                <input type="submit" value="다음 >" class="btn fw-bold">
            </div>
        </form>
        <script>
            document.querySelector("form").addEventListener("submit", function(event) {
                    event.preventDefault(); // 기본 서밋 동작 막기

                    var username = document.getElementById("usernameInput").value;
                    var email = document.getElementById("emailInput").value;

                    // 아이디 확인
                    fetch(`/user/check?username=${username}&email=${email}`, {
                        method: "POST"
                    })
                    .then(response => {
                        if (response.ok) {
                            return response.text();
                        } else {
                            throw new Error("서버로부터 데이터를 가져올 수 없습니다.");
                        }
                    })
                    .then(data => {
                        if (data === "아이디가 존재하지 않습니다.") {
                            // 아이디가 존재하지 않음을 알리는 알림창 표시
                            document.getElementById("alertMessage").textContent = data;
                            document.getElementById("alertMessage").style.display = "block";
                        } else if (data === "이메일이 일치하지 않습니다.") {
                            // 이메일이 일치하지 않음을 알리는 알림창 표시
                            document.getElementById("alertMessage").textContent = data;
                            document.getElementById("alertMessage").style.display = "block";
                        } else if (data === "아이디와 이메일이 일치합니다.") {
                            // 아이디와 이메일이 일치함을 알리는 메시지를 처리하는 코드 작성
                            // 예: 페이지를 리디렉션하거나 다른 동작 수행
                        }
                    })
                    .catch(error => {
                        console.error(error);
                    });
                });
        </script>
    </div>
</div>
</html>